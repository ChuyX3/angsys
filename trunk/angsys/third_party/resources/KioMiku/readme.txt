キオ式初音ミク1.4 for Blender

キオさんが作成した六角大王用の初音ミクモデルをBlenderに移植した物です
使用制限等はキオさんのモデルに準じます
改造・動画作成等は自由にやって構いません

Blenderの基本操作は以下のサイトで習得して下さい
http://wbs.nsf.tc/tutorial/tutorial_blender.html
http://f11.aaa.livedoor.jp/~hige/
http://www.nicovideo.jp/mylist/5515640


使用例

使用例として片足と体の向きを移動させたモーションを設定してあります
左側にある再生ボタンを押すと操作できないくらい重い計算を始めますが
BlenderをアクティブにしてEscキー数回押すと止まります
適当に他の事をして60フレームくらいで止めて下さい
この時点で60フレーム程度まで物理シミュレーションのキャッシュが作成されます
巻き戻しボタンを押して再度再生ボタンを押して下さい
すると結構早く再生されます
リアルタイムに再生する方法は・・・ｽｲﾏｾﾝﾖｸﾜｶﾘﾏｾﾝ/ ,' 3 `ヽ
でもスカートやツインテールの物理シミュはできてると思います


オブジェクト一覧

オブジェクトの一覧が左上のOutlinerパネルに表示されてます
Bone_なんたらはボーン
Sim_なんたらは物理シミュレーションで使う形状メッシュ
Bone_Sim_なんたらはSim_なんたらで使ってるボーン
Shape_なんたらは操作関連のボーンに適用した元の形状メッシュ
その他は本来の形状メッシュです

このパネルの右側3列に目と矢印と四角いアイコンがありますが
それぞれ表示と選択とレンダリングのOn Offの意味で
クリックすると各オブジェクトの設定を変えられます
クロスシミュを使っているところのボーンは非表示にしていますが
閉じた目をクリックすると表示されます


ボーンの操作

主に操作するのはBone_Bodyオブジェクトのボーンです
赤はIKボーン(IK_なんたら)
青はターゲット、またはポールターゲット(T_なんたら、またはPT_なんたら)
手関係は黄色にしてます
Gで移動(Grab)、R(Rotate)で回転、Sで(Scale)拡大ですが
Altを押しながらそれぞれのキーを押すと初期状態に戻せます
時々Gの隣のHを押して選択してる物を非表示設定にしてしまう場合がありますが
これも同じようにAlt+Hで元に戻せます

Iでキーフレームを打てますが、赤く丸いボタンが押されていると自動で打ってくれます
これも同じようにキーを消したいフレームに移動してからAlt+Iで消せますが
キーを打ったボーンを選択してからでないと消せないので
面倒ならAでボーンを全選択してからAlt+I、Availableで消せばいいと思います

球や立方体や八面体のボーンは回転できませんが
特徴的な形のボーンは大抵回転できる方向があります
指は各ボーンの先端に各指の第一関節が追従するようにしてあります
ボーンを回転させると指を伸ばしたまま追従しますが
縮小させるとそれに応じて曲がります
Sizeと名前があるボーンもSで大きさを変えられます
あとは3D Viewの左下に出る名前で推測して下さい

肩周りが変な動きをする場合がありますが
腰のあたりにあるひじのポールターゲットを移動してなんとか修正して下さい
肩はやっぱり難しいです/ ,' 3 `ヽ


物理シミュレーション

物理シミュレーションとしてクロスシミュレーションを使っていますが
安定性や速度を考慮した結果、大雑把な形状を使っているところがあります
クロスシミュを設定してあるメッシュは全部で6つ
Sim_Hair（前髪）
Sim_Twintail（ツインテール）
Sim_Tie（ネクタイ）
Sim_Beltparts（ベルト）
Clothes（服）
Skirt（スカート）
Sim_がついているのが簡易メッシュ、服とスカートが本来のメッシュで
クロスシミュレーションをしています
簡易メッシュでのクロスシミュは結構適当で突き抜けたりします・・・/ ,' 3 `ヽ

動作が怪しい時はクロスシミュのキャッシュを消すと直る場合があります
消す場合はまずクロスシミュが設定してあるメッシュを選択して
下のパネルでF7を押してオブジェクトパネルを表示すると
CollisionタブにFree Cacheのボタンがあるのでそれで消せます
結構頻繁におかしくなるので動きが怪しい時はまずこれを試してみて下さい
他に注意点としてクロスシミュは1フレーム目から計算しないとうまく動きません

クロスシミュで動くメッシュも手動のボーンで動かせるようにはしていますが
クロスシミュの計算をしてから動かすとターゲット等の位置がズレると思います
手動での微調整は感覚でなんとかして下さい/ ,' 3 `ヽ


クロスシミュレーションの無効と再設定

動きの確認等、重くてクロスシミュを使いたくない時は
クロスシミュが設定されている各メッシュを選択して
オブジェクトパネルClothボタン押すと設定を無効にできます
一旦切るとクロスシミュ設定がBlenderデフォルトに戻ってしまうので
再度使用する時は材質と固定位置を再設定しないと上手く動きません

各メッシュの初期設定Material Prisetは
Sim_Hair（前髪）とSim_Tie（ネクタイ）と
Sim_Beltparts（ベルト）とClothes（服）がLeather
Sim_Twintail（ツインテール）がDenim
Skirt（スカート）がRubber
Qualityは最低の4にして処理を速くした方がいいですが
ツインテールだけはそばに腕があるので突き抜け防止に12の方がいいです
Pinning of clothはPinにして下さい

そしてここが少々手こずったのですが
服とスカートのクロスシミュを再設定する際はモディファイアの順番も
入れ替える必要があります
各メッシュを選択して下のパネルでF9を押してエディットパネルにすると
Modifiersと書かれてるタブが右側にあります
モディファイアが多いと縦に長くなってしまうので
中央ボタンドラッグで把握して下さい
クロスシミュを再設定した直後は一番下にClothと追加されてるので
その右上にある∧∨のボタンで上下の順番を入れ替えて
Collisionの直上、Armatureの直下に移動して下さい


その他

既知のバグ
Sim_Twintailのクロスシミュ設定を無効にしている際に
Bone_Bodyのどこかのボーンを選択したまま保存して再度読み込むと
ツインテールが変な方向を向く

解決方法
(一旦何かのメッシュを選択して)Bone_Bodyのどこかのボーンを移動か何かする
見た目が変になるだけで内部処理は何も変わってないようです


BlenderにはPoseライブラリという機能も実装されたので
面倒な指のポーズやよく使うポーズは登録して使った方がいいかもしれません
http://blender.jp/modules/xfsection/article.php?articleid=248
ポーズのコピペや左右へのミラーは3D Viewパネルの右端の3つの矢印ボタンでできます


ボーンのレイヤーは
左端に操作関連のボーン
左から2番目にボーンヒートウェイティングで適用したボーン
左から3番目にその他色々普段使わなそうなのを置いてます
ボーンがあるレイヤーは●の印があります
ボーンレイヤーは初期設定では左端だけ見えるようにしてるので
操作関連のボーンが無いBone_Sim_Twintail等は
ボーンレイヤーを切り替えないと見えません

接地関連のボーンがBone_Bodyの左から3番目のボーンレイヤーにあります
足のあたりにLimit_なんたらというボーンが数本あるので
接地変えたい人は移動なりなんなりして下さい


簡易メッシュでのクロスシミュレーションは
本来のメッシュに普通にボーンとウェイトを適用した後
そのボーンのIK Constraintのターゲットに簡易メッシュのVertexGroupを設定してます
概ねうまく動きますが点へのターゲットなのでネクタイの捻りは再現できません/ ,' 3 `ヽ

あと実際動画を作ってみるとわかるのですが
本来のメッシュを使ってクロスシミュを設定している服とスカートは
現実の布以上にかなりビダビダ動きます
抑えたい場合はクロスシミュの設定を色々いじってみて下さい/ ,' 3 `ヽ
経験上GravityのZ値を増やすといいと思います

他のメッシュを使って衝突判定等させる時は
Cloth同様モディファイアの順番が結構重要です
Subsurfの下にあると分割後の計算処理になるので
ClothもCollisionもSubsurfの上にした方がいいです
これを怠るとやけに重くなったりします/ ,' 3 `ヽ


テクスチャは結構適当なので直したい人は各自直して下さい/ ,' 3 `ヽ

質問等がありましたら・・・多分サイトを持っても更新しないと思うので
各自なんとかして下さい/ ,' 3 `ヽ


※六角からの変換について

六角からの変換は主にLWO2形式で書き出していますが
LWO2だと強制的にマテリアル毎に分割されてインポートされます
普通のメッシュならメッシュ毎Joinして終わりですが問題はモーフです
http://render360.seesaa.net/article/43954298.html
ここで紹介されているRvkスクリプトを使いたいのですが
このスクリプトは複数のメッシュをJoinして同じ形にしたメッシュでも
Joinの順番が違うと別のメッシュと認識されて使えません
それで数十通りある顔のモーフをどうインポートすればいいか迷っていたのですが
obj形式ならマテリアル無しでそのまま持ってこれるのでobjで書き出しました
モーフがある部分以外は削除して書き出せば1メッシュで書き出せ、Rvkスクリプトも使えます
顔以外はLWO2形式の倍率0.05
顔はobj形式の倍率0.5でZ軸で180度回転させるとピッタリ合ったので
モーフのインポートの手間は最小限で済みました
